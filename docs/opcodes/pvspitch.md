<!--
id:pvspitch
category:Spectral Processing:Streaming
-->
# pvspitch
Track the pitch and amplitude of a PVS signal as k-rate variables.

## Syntax
``` csound-orc
kfr, kamp pvspitch fsig, kthresh
```

### Performance

_kamp_ -- Amplitude of fundamental frequency

_kfr_ -- Fundamental frequency

_fsig_ -- an input pv stream

_kthresh_ -- analysis threshold (between 0 and 1). Higher values will eliminate low-amplitude components from the analysis.

### Performance

The pitch detection algorithm implemented by _pvspitch_ is based upon  J. F. Schouten's hypothesis of the neural processes of the brain used to determine the pitch of a sound after the frequency analysis of the basilar membrane.  Except for some further considerations, _pvspitch_ essentially seeks out the highest common factor of an incoming sound's spectral peaks to find the pitch that may be attributed to it.

In general, input sounds that exhibit pitch will also exhibit peaks in their spectrum according to where their harmonics lie. There are some the exceptions, however.  Some sounds whose spectral representation is continuous can impart a sensation of pitch.  Such sounds are explained by the centroid or center of gravity of the spectrum and are beyond the scope of the method of pitch detection implemented by _pvspitch_ (Using opcodes like [pvscent](../../opcodes/pvscent) might be more appriopriate in these cases).

_pvspitch_ is able (using a previous analysis _fsig_ generated by [pvsanal](../../opcodes/pvsanal)) to locate the spectral peaks of a signal. The threshold parameter (_kthresh_) is of utmost importance, as adjusting it can introduce weak yet significant harmonics into the calculation of the fundamental. However, bringing _kthresh_ too low would allow harmonically unrelated partials into the analysis algorithm and this will compromise the method's accuracy.  These initial steps emulate the response of the basilar membrane by identifying physical characteristics of the input sound. The choice of _kthresh_ depends on the actual level of the input signal, since its range (from 0 to 1) spans the whole dynamic range of an analysis bin (from -inf to 0dBFS).

It is important to remember that the input to the _pvspitch_ opcode is assumed to be characterised by strong partials within its spectrum.  If this is not the case, the results outputted by the opcode may not bear any relation to the pitch of the input signal.  If a spectral frame with many unrelated partials was analysed, the greatest common factor of these frequency values that allows for adjacent “harmonics” would be chosen.  Thus, noisy frames can be characterised by low frequency outputs of _pvspitch_. This fact allows for a primitive type of instrumental transient detection, as the attack portion of some instrumental tones contain inharmonic components.  Should the lowest frequency of the analysed melody be known, then all frequencies detected below this threshold are inaccurate readings, due to the presence of unrelated partials.

In order to facilitate efficient testing of the _pvspitch_ algorithm, an amplitude value proportional to the one in the observed in the signal frame is also outputted (_kamp_).  The results of _pvspitch_ can then be employed to drive an oscillator whose pitch can be audibly compared with that of the original signal (In the example below, an oscillator generates a signal which appears a fifth above the detected pitch).

## Examples

Here is an example of the pvspitch opcode. It uses the file [pvspitch.csd](../../examples/pvspitch.csd). This example uses realtime audio input but can be used for audiofile input as well.

``` csound-csd title="Example of the pvspitch opcode" linenums="1"
--8<-- "examples/pvspitch.csd"
```

## See also

[Tools for Real-time Spectral Processing (pvs opcodes)](../../spectral/realtime)

[Sensing and Control: Tempo and Pitch estimation](../../control/sensing)

## Credits

Author: Alan OCinneide<br>
August 2005, added by Victor Lazzarini, August 2006<br>
Part of the text has been adapted from the Csound Journal winter 2006 issue's article "Introducing PVSPITCH: A pitch tracking opcode for Csound" by Alan OCinneide. The article is available at: [www.csoundjournal.com/2006winter/pvspitch.html](http://www.csoundjournal.com/2006winter/pvspitch.html)<br>
