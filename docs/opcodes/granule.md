<!--
id:granule
category:Signal Generators:Granular Synthesis
-->
# granule
A more complex granular synthesis texture generator.

The _granule_ unit generator is more complex than _grain_, but does add new possibilities.

_granule_ is a Csound unit generator which employs a wavetable as input to produce granularly synthesized audio output. Wavetable data may be generated by any of the GEN subroutines such as [GEN01](../../scoregens/gen01) which reads an audio data file into a wavetable. This enable a sampled sound to be used as the source for the grains. Up to 128 voices are implemented internally. The maximum number of voices can be increased by redefining the variable MAXVOICE in the grain4.h file. _granule_ has a build-in random number generator to handle all the random offset parameters. Thresholding is also implemented to scan the source function table at initialization stage. This facilitates features such as skipping silence passage between sentences.

The characteristics of the synthesis are controlled by 22 parameters. _xamp_ is the amplitude of the output and it can be either audio rate or control rate variable.

## Syntax
``` csound-orc
ares granule xamp, ivoice, iratio, imode, ithd, ifn, ipshift, igskip, \
             igskip_os, ilength, kgap, igap_os, kgsize, igsize_os, iatt, idec \
             [, iseed] [, ipitch1] [, ipitch2] [, ipitch3] [, ipitch4] [, ifnenv]
```

### Initialization

_ivoice_ -- number of voices.

_iratio_ -- ratio of the speed of the gskip pointer relative to output audio sample rate. eg. 0.5 will be half speed.

_imode_ -- +1 grain pointer move forward (same direction of the gskip pointer), -1 backward (oppose direction to the gskip pointer) or 0 for random.

_ithd_ -- threshold, if the sampled signal in the wavetable is smaller then _ithd_, it will be skipped.

_ifn_ -- function table number of sound source.

_ipshift_ -- pitch shift control. If _ipshift_ is 0, pitch will be set randomly up and down an octave. If _ipshift_ is 1, 2, 3 or 4, up to four different pitches can be set amount the number of voices defined in _ivoice_. The optional parameters _ipitch1_, _ipitch2_, _ipitch3_ and _ipitch4_ are used to quantify the pitch shifts.

_igskip_ -- initial skip from the beginning of the function table in sec.

_igskip_os_ -- gskip pointer random offset in sec, 0 will be no offset.

_ilength_ -- length of the table to be used starting from _igskip_ in sec.

_igap_os_ -- gap random offset in % of the gap size, 0 gives no offset.

_igsize_os_ -- grain size random offset in % of grain size, 0 gives no offset.

_iatt_ -- attack of the grain envelope in % of grain size.

_idec_ -- decade of the grain envelope in % of grain size.

_iseed_ (optional, default=0.5) -- seed for the random number generator.

_ipitch1, ipitch2, ipitch3, ipitch4_ (optional, default=1) -- pitch shift parameter, used when _ipshift_ is set to 1, 2, 3 or 4. Time scaling technique is used in pitch shift with linear interpolation between data points. Default value is 1, the original pitch.

_ifnenv_ (optional, default=0) -- function table number to be used to generate the shape of the envelope.

### Performance

_xamp_ -- amplitude.

_kgap_ -- gap between grains in sec.

_kgsize_ -- grain size in sec.

## Examples

Here is an example of the granule opcode. It uses the files [granule.csd](../../examples/granule.csd), [marimba.aif](../../examples/marimba.aif) and [fox.wav](../../examples/fox.wav)

``` csound-orc title="Example of the granule opcode." linenums="1"
--8<-- "examples/granule.csd"
```

The above example reads a sound file called _marimba.aif_ into wavetable number 1, a second reads _fox.wav_ into wavetable number 2. The first note generates 10 seconds of stereo audio output using the wavetable. In the orchestra file, all parameters required to control the synthesis are passed from the score file. A _linseg_ function generator is used to generate an envelope with 0.5 second of linear attack and decay. Stereo effect is generated by using different seeds for the two _granule_ function calls. In the example, 0.17 is added to p20 (= iseed) before passing into the second _granule_ call to ensure that all of the random offset events are different from the first one.

The second note (wavetable number 2) has slightly different parameters.

In the score file for the first note, the parameters are interpreted as:

| Parameter                     | Interpreted As |
|:------------------------------|:---------------|
| p5 (_ivoice_)                 | the number of voices is set to 64 |
| p6 (_iratio_)                 | set to 0.5, it scans the wavetable at half of the speed of the audio output rate |
| p7 (_imode_)                  | set to 0, the grain pointer only move forward |
| p8 (_ithd_)                   | set to 0, skipping the thresholding process |
| p9 (_ifn_)                    | set to 1, function table number 1 is used |
| p10 (_ipshift_)               | set to 4, four different pitches are going to be generated |
| p11 (_igskip_)                | set to 0 and p12 (_igskip_os_) is set to 0.005, no skipping into the wavetable and a 5 mSec random offset is used |
| p13 (_ilength_)               | set to 1, 1 second of the wavetable is to be used |
| p14 (_kgap_)                  | set to 0.01 and p15 (_igap_os_) is set to 50, 10 mSec gap with 50% random offset is to be used |
| p16 (_kgsize_)                | set to 0.02 and p17 (_igsize_os_) is set to 50, 20 mSec grain with 50% random offset is used |
| p18 (_iatt_) and p19 (_idec_) | set to 25, 25% of linear attack and decade is applied to the grain |
| p20 (_iseed_)                 | seed for the random number generator is set to 0.39 |
| p21 - p24                     | pitches set to 1 which is the original pitch, 1.42 which is a 5th up, 0.29 which is a 7th down and finally 2 which is an octave up. |

## See Also

[Granular Synthesis](../../siggen/granular)

## Credits

Author: Allan Lee

Belfast

1996

New in version 3.35
